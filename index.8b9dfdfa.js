!function(){function e(e,t,n,r,i,a,o){try{var l=e[a](o),u=l.value}catch(e){n(e);return}l.done?t(u):Promise.resolve(u).then(r,i)}function t(t){return function(){var n=this,r=arguments;return new Promise(function(i,a){var o=t.apply(n,r);function l(t){e(o,i,a,l,u,"next",t)}function u(t){e(o,i,a,l,u,"throw",t)}l(void 0)})}}function n(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function l(l){return function(u){return function(l){if(n)throw TypeError("Generator is already executing.");for(;a&&(a=0,l[0]&&(o=0)),o;)try{if(n=1,r&&(i=2&l[0]?r.return:l[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,l[1])).done)return i;switch(r=0,i&&(l=[2&l[0],i.value]),l[0]){case 0:case 1:i=l;break;case 4:return o.label++,{value:l[1],done:!1};case 5:o.label++,r=l[1],l=[0];continue;case 7:l=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===l[0]||2===l[0])){o=0;continue}if(3===l[0]&&(!i||l[1]>i[0]&&l[1]<i[3])){o.label=l[1];break}if(6===l[0]&&o.label<i[1]){o.label=i[1],i=l;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(l);break}i[2]&&o.ops.pop(),o.trys.pop();continue}l=t.call(e,o)}catch(e){l=[6,e],r=0}finally{n=i=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,u])}}}function r(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function i(e,t,n){if(!t.has(e))throw TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}function a(e,t){var n=i(e,t,"get");return n.get?n.get.call(e):n.value}function o(e,t){if(t.has(e))throw TypeError("Cannot initialize the same private elements twice on an object")}function l(e,t,n){o(e,t),t.set(e,n)}function u(e,t,n){var r=i(e,t,"set");return!function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw TypeError("attempted to set read only private field");t.value=n}}(e,r,n),n}function s(e,t,n){if(!t.has(e))throw TypeError("attempted to get private field on non-instance");return n}function c(e,t){o(e,t),t.add(e)}function h(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function f(e,t,n){return t&&h(e.prototype,t),n&&h(e,n),e}function v(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function d(e,t){if(e){if("string"==typeof e)return y(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return y(e,t)}}function p(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n,r,i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=i){var a=[],o=!0,l=!1;try{for(i=i.call(e);!(o=(n=i.next()).done)&&(a.push(n.value),!t||a.length!==t);o=!0);}catch(e){l=!0,r=e}finally{try{o||null==i.return||i.return()}finally{if(l)throw r}}return a}}(e,t)||d(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m(e){return function(e){if(Array.isArray(e))return y(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||d(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}"function"==typeof SuppressedError&&SuppressedError;var w=/*#__PURE__*/new WeakMap,g=/*#__PURE__*/new WeakMap,b=/*#__PURE__*/new WeakMap,k=/*#__PURE__*/new WeakMap,T=/*#__PURE__*/new WeakMap,M=/*#__PURE__*/function(){function e(t,n,i){r(this,e),l(this,w,{writable:!0,value:void 0}),l(this,g,{writable:!0,value:void 0}),l(this,b,{writable:!0,value:void 0}),l(this,k,{writable:!0,value:void 0}),l(this,T,{writable:!0,value:void 0}),u(this,w,t),u(this,g,n),u(this,b,i)}return f(e,[{key:"x",get:function(){return a(this,g)}},{key:"y",get:function(){return a(this,b)}},{key:"tile",get:function(){return a(this,k)},set:function(e){u(this,k,e),null!=e&&(a(this,k).x=a(this,g),a(this,k).y=a(this,b))}},{key:"mergeTile",get:function(){return a(this,T)},set:function(e){u(this,T,e),null!=e&&(a(this,T).x=a(this,g),a(this,T).y=a(this,b))}},{key:"canAccept",value:function(e){return null==this.tile||null==this.mergeTile&&this.tile.value===e.value}},{key:"mergeTiles",value:function(){if(null!=this.tile&&null!=this.mergeTile)return this.tile.value=this.tile.value+this.mergeTile.value,this.mergeTile.remove(),this.mergeTile=null,this.tile.value}}]),e}(),S=/*#__PURE__*/new WeakMap,E=/*#__PURE__*/new WeakMap,A=/*#__PURE__*/new WeakMap,L=/*#__PURE__*/new WeakMap,W=/*#__PURE__*/function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.random()>.1?2:4;r(this,e),l(this,S,{writable:!0,value:void 0}),l(this,E,{writable:!0,value:void 0}),l(this,A,{writable:!0,value:void 0}),l(this,L,{writable:!0,value:void 0}),u(this,S,document.createElement("div")),a(this,S).classList.add("game__tile"),t.append(a(this,S)),this.value=n}return f(e,[{key:"value",get:function(){return a(this,L)},set:function(e){u(this,L,e),a(this,S).textContent=e,a(this,S).className="game__tile game__tile--".concat(e)}},{key:"x",get:function(){return a(this,E)},set:function(e){u(this,E,e),a(this,S).style.setProperty("--x",e)}},{key:"y",get:function(){return a(this,A)},set:function(e){u(this,A,e),a(this,S).style.setProperty("--y",e)}},{key:"remove",value:function(){a(this,S).remove()}},{key:"waitForTransition",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new Promise(function(n){a(e,S).addEventListener(t?"animationend":"transitionend",n,{once:!0})})}}]),e}(),_=/*#__PURE__*/new WeakMap,U=/*#__PURE__*/new WeakMap,x=/*#__PURE__*/new WeakMap,R=/*#__PURE__*/new WeakSet,C=/*#__PURE__*/new WeakSet,G=/*#__PURE__*/function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;r(this,e),l(this,x,{get:D,set:void 0}),c(this,R),c(this,C),l(this,_,{writable:!0,value:void 0}),l(this,U,{writable:!0,value:void 0}),u(this,U,t),t.style.setProperty("--grid-size",P),u(this,_,s(this,R,I).call(this,t).map(function(e,t){return new M(e,t%P,Math.floor(t/P))})),n&&s(this,C,O).call(this,n)}return f(e,[{key:"gridElement",get:function(){return a(this,U)}},{key:"cells",get:function(){return a(this,_)}},{key:"cellsByRow",get:function(){return a(this,_).reduce(function(e,t){return e[t.y]=e[t.y]||[],e[t.y][t.x]=t,e},[])}},{key:"cellsByColumn",get:function(){return a(this,_).reduce(function(e,t){return e[t.x]=e[t.x]||[],e[t.x][t.y]=t,e},[])}},{key:"randomEmptyCell",value:function(){var e=Math.floor(Math.random()*a(this,x).length);return a(this,x)[e]}},{key:"spawnTile",value:function(){var e=this.randomEmptyCell();if(e){var t=new W(this.gridElement);return e.tile=t,t}}},{key:"clear",value:function(){a(this,_).forEach(function(e){e.tile&&(e.tile.remove(),e.tile=null),e.mergeTile&&(e.mergeTile.remove(),e.mergeTile=null)})}}]),e}();function D(){return a(this,_).filter(function(e){return null==e.tile})}function I(e){for(var t=[],n=0;n<P*P;n++){var r=document.createElement("div");r.classList.add("game__cell"),t.push(r),e.append(r)}return t}function O(e){for(var t=this,n=function(n){for(var r=function(r){var i=e[n][r];if(i){var o=a(t,_).find(function(e){return e.x===r&&e.y===n}),l=new W(a(t,U),i);o.tile=l}},i=0;i<e[n].length;i++)r(i)},r=0;r<e.length;r++)n(r)}var P=4,B=/*#__PURE__*/new WeakMap,N=/*#__PURE__*/new WeakMap,j=/*#__PURE__*/new WeakMap,F=/*#__PURE__*/new WeakSet,q=/*#__PURE__*/new WeakSet,H=/*#__PURE__*/function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;r(this,e),c(this,F),c(this,q),l(this,B,{writable:!0,value:void 0}),l(this,N,{writable:!0,value:void 0}),l(this,j,{writable:!0,value:void 0}),u(this,B,new G(t,n)),u(this,N,e.GAME_STATUS.idle),u(this,j,0)}return f(e,[{key:"grid",get:function(){return a(this,B)}},{key:"score",get:function(){return a(this,j)}},{key:"status",get:function(){return a(this,N)}},{key:"isGameOver",get:function(){return a(this,N)===e.GAME_STATUS.lose}},{key:"isWin",get:function(){return a(this,N)===e.GAME_STATUS.win}},{key:"start",value:function(){u(this,N,e.GAME_STATUS.playing),this.spawnTiles(2)}},{key:"restart",value:function(){a(this,B).clear(),u(this,N,e.GAME_STATUS.idle),u(this,j,0)}},{key:"tryMove",value:function(r){var i=this;return t(function(){var t,o,l,s,c,h,f,y,d,m;return n(this,function(n){switch(n.label){case 0:if(a(i,N)!==e.GAME_STATUS.playing)return[2];if(o=(t=e.DIRECTIONS).UP,l=t.DOWN,s=t.LEFT,c=t.RIGHT,v(h={},o,[i.canMoveUp,i.moveUp]),v(h,l,[i.canMoveDown,i.moveDown]),v(h,s,[i.canMoveLeft,i.moveLeft]),v(h,c,[i.canMoveRight,i.moveRight]),y=(f=p(h[r]||[],2))[0],d=f[1],!(null==y?void 0:y.call(i)))return[2,!1];return[4,d.call(i)];case 1:if(n.sent(),i.mergeTiles(),m=p(i.spawnTiles(1),1)[0],!(!i.canMoveUp()&&!i.canMoveDown()&&!i.canMoveLeft()&&!i.canMoveRight())||(u(i,N,e.GAME_STATUS.lose),!m))return[3,3];return[4,m.waitForTransition(!0)];case 2:n.sent(),n.label=3;case 3:return[2,!0]}})})()}},{key:"canMoveUp",value:function(){return s(this,F,z).call(this,a(this,B).cellsByColumn)}},{key:"canMoveDown",value:function(){return s(this,F,z).call(this,a(this,B).cellsByColumn.map(function(e){return m(e).reverse()}))}},{key:"canMoveLeft",value:function(){return s(this,F,z).call(this,a(this,B).cellsByRow)}},{key:"canMoveRight",value:function(){return s(this,F,z).call(this,a(this,B).cellsByRow.map(function(e){return m(e).reverse()}))}},{key:"moveUp",value:function(){return s(this,q,X).call(this,a(this,B).cellsByColumn)}},{key:"moveDown",value:function(){return s(this,q,X).call(this,a(this,B).cellsByColumn.map(function(e){return m(e).reverse()}))}},{key:"moveLeft",value:function(){return s(this,q,X).call(this,a(this,B).cellsByRow)}},{key:"moveRight",value:function(){return s(this,q,X).call(this,a(this,B).cellsByRow.map(function(e){return m(e).reverse()}))}},{key:"mergeTiles",value:function(){var t=this,n=0;a(this,B).cells.forEach(function(r){var i=r.mergeTiles();i&&(n+=i,2048===i&&u(t,N,e.GAME_STATUS.win))}),u(this,j,a(this,j)+n)}},{key:"spawnTiles",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=[],n=0;n<e;n++){var r=a(this,B).spawnTile();t.push(r)}return t}}]),e}();function z(e){return e.some(function(e){return e.some(function(t,n){return 0!==n&&null!=t.tile&&e[n-1].canAccept(t.tile)})})}function X(e){return Promise.all(e.flatMap(function(e){for(var t=[],n=1;n<e.length;n++){var r=e[n];if(null!=r.tile){for(var i=void 0,a=n-1;a>=0;a--){var o=e[a];if(!o.canAccept(r.tile))break;i=o}null!=i&&(t.push(r.tile.waitForTransition()),null!=i.tile?i.mergeTile=r.tile:i.tile=r.tile,r.tile=null)}}return t}))}v(H,"GAME_STATUS",{idle:"idle",playing:"playing",win:"win",lose:"lose"}),v(H,"DIRECTIONS",{UP:"up",DOWN:"down",LEFT:"left",RIGHT:"right"});var Y=document.querySelector(".game__field"),$=document.querySelector(".button"),J=document.querySelector(".game__score"),K=document.querySelector(".message--lose"),Q=document.querySelector(".message--win"),V=document.querySelector(".message--start"),Z=new H(Y),ee=H.DIRECTIONS,et=null,en=null;function er(e){e.preventDefault();var t=e.changedTouches[0];et=t.clientX,en=t.clientY}function ei(e){return ea.apply(this,arguments)}function ea(){return(ea=t(function(e){var t,r,i;return n(this,function(n){switch(n.label){case 0:if(e.preventDefault(),r=(t=e.changedTouches[0]).clientX-et,i=t.clientY-en,30>Math.abs(r)&&30>Math.abs(i))return[2];return[4,eo(Math.abs(r)>Math.abs(i)?r>0?ee.RIGHT:ee.LEFT:i>0?ee.DOWN:ee.UP)];case 1:return n.sent(),[2]}})})).apply(this,arguments)}function eo(e){return el.apply(this,arguments)}function el(){return(el=t(function(e){return n(this,function(t){switch(t.label){case 0:return[4,Z.tryMove(e)];case 1:if(t.sent()){if(eh(),Z.isWin)return Q.classList.remove("hidden"),ef(),[2];if(Z.isGameOver)return K.classList.remove("hidden"),ef(),[2]}return ec(),[2]}})})).apply(this,arguments)}function eu(e){return es.apply(this,arguments)}function es(){return(es=t(function(e){var t;return n(this,function(n){switch(n.label){case 0:if(!(t=({ArrowUp:ee.UP,ArrowDown:ee.DOWN,ArrowLeft:ee.LEFT,ArrowRight:ee.RIGHT})[e.key]))return ec(),[2];return[4,eo(t)];case 1:return n.sent(),[2]}})})).apply(this,arguments)}function ec(){window.addEventListener("keydown",eu,{once:!0})}function eh(){J.textContent=Z.score}function ef(){Y.removeEventListener("touchstart",er),Y.removeEventListener("touchend",ei)}$.addEventListener("click",function(){Z.status===H.GAME_STATUS.idle?($.classList.remove("button--start"),$.classList.add("button--restart"),$.textContent="Restart",V.classList.add("hidden"),Z.start(),ec(),Y.addEventListener("touchstart",er),Y.addEventListener("touchend",ei)):(Q.classList.add("hidden"),K.classList.add("hidden"),V.classList.remove("hidden"),$.classList.remove("button--restart"),$.classList.add("button--start"),$.textContent="Start",Z.restart(),eh(),ef())})}();
//# sourceMappingURL=index.8b9dfdfa.js.map
